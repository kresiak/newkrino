<div id="GGTOP"></div>
<div class="card">
    <div class="card-block">
        <ngb-tabset *ngIf="authorizationStatusInfo && authorizationStatusInfo.isLoggedIn">
            <ngb-tab title="View Otps" id="tabView">
                <template ngbTabContent>

                    <gg-otp-list [state]="state" [otpsObservable]="otpsObservable"></gg-otp-list>

                </template>
            </ngb-tab>
            <ngb-tab title="Soon expiring ({{nbExpiringOtps}})" id="tabViewExpiring" *ngIf="nbExpiringOtps">
                <template ngbTabContent>

                    <gg-otp-list [state]="state" [otpsObservable]="otpsObservableExpiring"></gg-otp-list>

                </template>
            </ngb-tab>
            <ngb-tab title="Create an Otp" id="tabCreate" *ngIf="authorizationStatusInfo.isAdministrator()">
                <template ngbTabContent>
                    <div class="card">
                        <div class="card-block">
                            <h6>Choose the equipe to which the new Otp will be attributed</h6>
                            <gg-equipe-list [equipesObservable]="equipesObservable" [initialTabInEquipeDetail]="'tabOtp'"></gg-equipe-list>
                        </div>
                    </div>
                </template>
            </ngb-tab>
            <ngb-tab title="Product classifications" id="tabProductClassifications">
                <template ngbTabContent>
                    <div class="card">
                        <div class="card-block">
                            <ngb-tabset>
                                <ngb-tab *ngIf="classificationsList && classificationsList.length > 0" title="List of classifications" id="tabListOfClassifications">
                                    <template ngbTabContent>
                                        <div class="card">
                                            <div class="card-block">
                                                <div class="row">
                                                    <div class="col-sm-2 vcenter"><b>Name</b></div>
                                                    <div class="col-sm-3 vcenter"><b>Description</b></div>
                                                    <div class="col-sm-6 vcenter"><b>Product categories</b></div>
                                                </div>
                                                <div *ngFor="let classificationsItem of classificationsList">
                                                    <div class="row">
                                                        <div class="col-sm-2 vcenter">
                                                            <gg-editor [content]="classificationsItem.name" [showControls]="true" 
                                                                (editSaved)="classificationsNameUpdated($event, classificationsItem)"
                                                                [readOnly]="!authorizationStatusInfo || !authorizationStatusInfo.isAdministrator()">
                                                            </gg-editor>
                                                        </div>
                                                        <div class="col-sm-3 vcenter">
                                                            <gg-editor [content]="classificationsItem.description" [showControls]="true" 
                                                                (editSaved)="classificationsDescriptionUpdated($event, classificationsItem)"
                                                                [readOnly]="!authorizationStatusInfo || !authorizationStatusInfo.isAdministrator()">
                                                            </gg-editor>
                                                        </div>
                                                        <div class="col-sm-6 vcenter">
                                                            <gg-selector 
                                                                [selectableData]="selectableCategoriesObservable" [selectedIds]="getCategoriesObservable(classificationsItem._id)" 
                                                                (selectionChanged)="categorySelectionChanged($event, classificationsItem)" (selectionOptionAdded)="categoryHasBeenAdded($event)" 
                                                                [readOnly]="!authorizationStatusInfo || !authorizationStatusInfo.isAdministrator()">
                                                            </gg-selector>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </template>
                                </ngb-tab>
                                <ngb-tab title="Create classification" id="tabCreateClassification" *ngIf="authorizationStatusInfo && authorizationStatusInfo.isAdministrator()">
                                    <template ngbTabContent>
                                        <div class="card">
                                            <div class="card-block">
                                                <div class="container-fluid">
                                                    <form [formGroup]="classificationForm" (ngSubmit)="save(classificationForm.value, classificationForm.valid)">
                                                        <div class="form-group row">
                                                            <label for="classificationName" class="col-sm-2 col-form-label col-xl-2">name:</label>
                                                            <div class="col-sm-10">
                                                                <input type="text" class="form-control" formControlName="classificationName" id="classificationName" placeholder="name">
                                                            </div>
                                                        </div>
                                                        <div class="form-group row">
                                                            <label for="classificationDescription" class="col-sm-2 col-form-label col-xl-2">description:</label>
                                                            <div class="col-sm-10">
                                                                <input type="text" class="form-control" formControlName="classificationDescription" id="classificationDescription" placeholder="description">
                                                            </div>
                                                        </div>
                                                        <div class="row">
                                                            <div class="col-sm-3 col-md-2 col-lg-2">
                                                                <button class="btn btn-success" type="submit" [disabled]="!classificationForm.valid">Submit</button>
                                                            </div>
                                                            <div class="col-sm-3 col-md-2 col-lg-2">
                                                                <button class="btn btn-info"  [disabled]="classificationForm.pristine" (click)="reset()">Reset</button>
                                                            </div>
                                                        </div>
                                                    </form>
                                                </div>
                                            </div>
                                        </div>
                                    </template>
                                </ngb-tab>
                            </ngb-tabset>
                        </div>
                    </div>
                </template>
            </ngb-tab>
        </ngb-tabset>
        <h4 *ngIf="authorizationStatusInfo && !authorizationStatusInfo.isLoggedIn">sorry: you are not logged in</h4>
    </div>
</div>
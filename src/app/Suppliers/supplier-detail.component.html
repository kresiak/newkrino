<template #popContent>{{isRoot ? 'Click here to go back to last view' : 'Click here to get a detail view'}}</template>

<template #sapIdResultPopup let-c="close" let-d="dismiss">
  <div class="modal-header">
    <h4 class="modal-title">Your web purchase has been registered</h4>
    <button type="button" class="close" aria-label="Close" (click)="d('Cross click')">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">
	<p>Please use following purchase id on web portal of the supplier: {{sapId}}</p>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-secondary" (click)="c('Close click')">Close</button>
  </div>
</template>


<ngb-tabset #tabset *ngIf="supplier" (tabChange)="beforeTabChange($event)" [activeId]="state.selectedTabId">
	<ngb-tab title="Info" id="tabInfo">
		<template ngbTabContent>
			<div class="card">
				<div class="card-block">
					<gg-supplier-info [supplier]="supplier.data"></gg-supplier-info>

					<div class="row" *ngIf="!authService.isProduction()">
						<div class="col-sm-2">_id:</div>
						<div class="col-sm-6">{{supplier.data._id}}</div>
					</div>

				</div>
			</div>
		</template>
	</ngb-tab>

	<ngb-tab title="Fix costs" id="tabFixCosts">
		<template ngbTabContent>
			<div class="card">
				<div class="card-block">
					<ngb-tabset>
						<ngb-tab title="Fix costs" id="tabFixCosts">
							<template ngbTabContent>
								<div class="card">
									<div class="card-block">
										<div class="container-fluid">
                                			<div class="row">
												<div class="col-sm-2 vcenter"><b>Price</b></div>
												<div class="col-sm-2 vcenter"><b>Description</b></div>
											</div>
											<div *ngFor="let costsObject of supplier.data.fixCosts">
												<div class="row">
													<div class="col-sm-2 vcenter">
														<gg-editor [content]="costsObject.price" [showControls]="true" [isMonetary]="true" (editSaved)="costsPriceUpdated(costsObject, $event)"></gg-editor>
													</div>
													<div class="col-sm-2 vcenter">
														<gg-editor [content]="costsObject.description" [showControls]="true" (editSaved)="costsDescriptionUpdated(costsObject, $event)"></gg-editor>
													</div>
												</div>
											</div>
                            			</div>
									</div>
								</div>
							</template>
						</ngb-tab>
						<ngb-tab title="Add Fix cost" id="tabAddFixCost">
							<template ngbTabContent>
								<div class="card">
									<div class="card-block">
										<div class="container-fluid">
											<form [formGroup]="fixCostsForm" (ngSubmit)="saveFixCosts(fixCostsForm.value, fixCostsForm.valid)">
												<div class="form-group row">
													<label for="descriptionFixCosts" class="col-sm-2 col-form-label col-xl-2">Description:</label>
													<div class="col-sm-10">
														<input type="text" min="1" class="form-control" formControlName="descriptionFixCosts" id="descriptionFixCosts" placeholder="Description of Fix Costs">
													</div>
												</div>
												<div class="form-group row">
													<label for="priceFixCosts" class="col-sm-2 col-form-label col-xl-2">Price:</label>
													<div class="col-sm-10">
														<input type="number" min="0" step="any" class="form-control" formControlName="priceFixCosts" id="priceFixCosts" placeholder="price fix costs">
													</div>
												</div>
												<div class="row">
													<div class="col-sm-3 col-md-2 col-lg-2">
														<button class="btn btn-success" type="submit" [disabled]="!fixCostsForm.valid">Submit</button>
													</div>
													<div class="col-sm-3 col-md-2 col-lg-2">
														<button class="btn btn-info" [disabled]="fixCostsForm.pristine" (click)="resetFixCosts()">Reset</button>
													</div>
												</div>
											</form>
										</div>
									</div>
								</div>
							</template>
						</ngb-tab>
					</ngb-tabset>
				</div>
			</div>
		</template>
	</ngb-tab>

	<ngb-tab title="Products" id="tabProducts">
		<template ngbTabContent>
			<gg-product-grid [path]="path+'|O:Products'" [productsObservable]="productsObservable" [config]="{skip:['supplier']}"></gg-product-grid>
		</template>
	</ngb-tab>
	<ngb-tab title="Orders" *ngIf="anyOrder" id="tabOrders">
		<template ngbTabContent>
			<gg-order-list [ordersObservable]="ordersObservable" [config]="{skip:['supplier']}" [path]="path+'|O:Orders'" [state]="state.Orders"
				(stateChanged)="childOrdersStateChanged($event)"></gg-order-list>
		</template>
	</ngb-tab>
	<ngb-tab title="Shopping Basket" *ngIf='isThereABasket' id="tabBasket">
		<template ngbTabContent>
			<div class="card">
				<div class="card-block">
					<div class="row">
						<gg-product-grid [path]="path+'|O:Basket'" [productsObservable]="productsBasketObservable" [config]="{skip:['category', 'otp', 'supplier', 'manip']}"></gg-product-grid>
					</div>
					<div class="row">
						<button class="btn btn-warning" (click)="gotoPreOrder()">Proceed to Checkout</button>
					</div>
				</div>
			</div>
		</template>
	</ngb-tab>
	<ngb-tab title="Add a product" id="tabAddProduct">
		<template ngbTabContent>
			<div class="card">
				<div class="card-block">
					<div class="row">
						<gg-product-enter [supplierId]="supplier.data._id"></gg-product-enter>
					</div>
				</div>
			</div>
		</template>
	</ngb-tab>
	<ngb-tab title="Web Shopping" id="tabWebShopping">
		<template ngbTabContent>
			<div class="card">
				<div class="card-block">
					<ngb-tabset (tabChange)="beforeWebShoppingTabChange($event)" [activeId]="state.selectedWebShoppingTabId">
						<ngb-tab title="Administration" id="tabWebShoppingAdmin" *ngIf="showAdminWebShoppingTab">
							<template ngbTabContent>
								<div class="card">
									<div class="card-block">
										<div class="row">
											<div class="col-sm-4 vcenter">web shopping enabled:</div>
											<div class="col-sm-6 vcenter">
												<gg-editor-boolean [content]="supplier.data.webShopping && supplier.data.webShopping.isEnabled" (editSaved)="webShoppingUpdated($event)"></gg-editor-boolean>
											</div>
										</div>
										<div class="row">
											<div class="col-sm-4 vcenter">allowed products:</div>
											<div class="col-sm-6 vcenter">
												<gg-selector [selectableData]="selectableCategoriesObservable" [selectedIds]="selectedCategoryIdsObservable" (selectionChanged)="categorySelectionChanged($event)"
													(selectionOptionAdded)="categoryHasBeenAdded($event)"></gg-selector>
											</div>
										</div>
									</div>
								</div>
							</template>
						</ngb-tab>
						<div *ngIf="supplier.data.webShopping && supplier.data.webShopping.categoryIds && supplier.data.webShopping.categoryIds.length > 0">
							<ngb-tab *ngFor="let category of supplier.annotation.webShopping.categories" title="Vouchers {{category.name}}" id="tabWebShoppingVoucher{{category.id}}">
								<template ngbTabContent>
									<div class="card">
										<div class="card-block">
											<div class="row">
												<div class="col-sm-4 vcenter">vouchers available:</div>
												<div class="col-sm-6 vcenter">{{nbVouchersAvailable(category.id)}}</div>
											</div>
											<div class="row">
												<div class="col-sm-4 vcenter">vouchers ordered:</div>
												<div class="col-sm-6 vcenter">
													<gg-editor-number [content]="nbVouchersOrdered(category.id)" [editMode]="true" (editSaved)="nbVouchersOrderedUpdated(category.id, $event)"></gg-editor-number>
												</div>
											</div>
											<div class="row" *ngIf="nbVouchersAvailable(category.id) > 0">
												<p>
													<button type="button" class="btn btn-outline-primary" (click)="showUseVoucherForm = !showUseVoucherForm" [attr.aria-expanded]="!showUseVoucherForm"
														aria-controls="collapseExample">Make use of a {{category.name}} voucher</button>
												</p>
												<div id="collapseExample" [ngbCollapse]="!showUseVoucherForm">
													<div class="card">
														<div class="card-block">
															<div>Fill this form adequately and you will get the Sap Id that you need in order to place your order on the {{supplier.data.name}} webshopping platform.</div><br/>
															<form [formGroup]="useVoucherForm" (ngSubmit)="save(useVoucherForm.value, useVoucherForm.valid, supplier.data._id, category.id)">
																<div class="form-group row">
																	<label for="description" class="col-sm-2 col-form-label col-xl-2">Description:</label>
																	<div class="col-sm-10">
																		<input type="text" class="form-control" formControlName="description" id="description" placeholder="description of the product">
																	</div>
																</div>
																<div class="form-group row">
																	<label for="price" class="col-sm-2 col-form-label col-xl-2">Price:</label>
																	<div class="col-sm-10">
																		<input type="number" min="1" step="any" class="form-control" formControlName="price" id="price" placeholder="total price of web shopping (with VAT)">
																	</div>
																</div>
																<div class="form-group row">
																	<label for="price" class="col-sm-2 col-form-label col-xl-2"></label>
																	<div class="col-sm-10">
																		<input type="checkbox"  #iAgree> The information I have entered here is correct and correspond to what I have entered on the {{supplier.data.name}} website.<br>
																	</div>
																</div>
																<div class="row" >
																	<div class="col-sm-3 col-md-2 col-lg-2">
																		<button class="btn btn-success" type="submit" [disabled]="!useVoucherForm.valid || !iAgree.checked">Submit</button>
																	</div>
																	<div class="col-sm-3 col-md-2 col-lg-2">
																		<button class="btn btn-info" [disabled]="useVoucherForm.pristine" (click)="reset()">Reset</button>
																	</div>
																</div>
																<div class="row" *ngIf="voucherUseError">
																	<p>The voucher could not be used: {{voucherUseError}}</p>
																</div>
															</form>
														</div>
													</div>
												</div>
											</div>
										</div>
									</div>
								</template>
							</ngb-tab>
						</div>
					</ngb-tabset>
				</div>
			</div>
		</template>
	</ngb-tab>
	<ngb-tab id="tabMax">
		<template ngbTabTitle><img src="../../images/maximize.png" [ngbPopover]="popContent" triggers="mouseenter:mouseleave" /></template>
		<template ngbTabContent></template>
	</ngb-tab>
	<ngb-tab id="gotoTop" *ngIf="!isRoot && path!=='dashboard'">
		<template ngbTabTitle><img src="../../images/gototop.png" ngbPopover="Goto top of the page" triggers="mouseenter:mouseleave" /></template>
		<template ngbTabContent></template>
	</ngb-tab>

</ngb-tabset>
<template #popContent>{{isRoot ? 'Click here to go back to last view' : 'Click here to get a detail view'}}</template>

<template #sapIdResultPopup let-c="close" let-d="dismiss">
  <div class="modal-header">
    <h4 class="modal-title">Your web purchase has been registered</h4>
    <button type="button" class="close" aria-label="Close" (click)="d('Cross click')">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">
	<p>Please use following purchase id on web portal of the supplier: {{sapId}}</p>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-secondary" (click)="c('Close click')">Close</button>
  </div>
</template>


<ngb-tabset #tabset *ngIf="supplier" (tabChange)="beforeTabChange($event)" [activeId]="state.selectedTabId">
	<ngb-tab title="{{'SUPPLIER.MENU.INFO' | translate}}" id="tabInfo">
		<template ngbTabContent>
			<div class="card">
				<div class="card-block">
					<gg-supplier-info [supplier]="supplier.data"></gg-supplier-info>

					<div class="row" *ngIf="!configService.isProduction()">
						<div class="col-sm-2">_id:</div>
						<div class="col-sm-6">{{supplier.data._id}}</div>
					</div>

				</div>
			</div>
		</template>
	</ngb-tab>

	<ngb-tab title="{{'SUPPLIER.MENU.FIX COSTS' | translate}} ({{(fixCosts && fixCosts.length>0) ? fixCosts.length : 0}})" id="tabFixCosts" *ngIf="authorizationStatusInfo && !authorizationStatusInfo.isGroupOrdersUser()">
		<template ngbTabContent>
			<div class="card">
				<div class="card-block">
					<ngb-tabset>
						<ngb-tab title="{{'SUPPLIER.MENU.FIX COSTS' | translate}}" id="tabFixCosts" *ngIf="fixCosts && fixCosts.length>0">
							<template ngbTabContent>
								<div class="card">
									<div class="card-block">
										<div class="container-fluid">
                                			<div class="row">
												<div class="col-sm-3 vcenter"><b>Description</b></div>
												<div class="col-sm-2 vcenter"><b>Price</b></div>
												<div class="col-sm-2 vcenter" *ngIf="authorizationStatusInfo && authorizationStatusInfo.isAdministrator()"><b>Disable</b></div>
											</div>
											<div *ngFor="let fixCost of fixCosts">
												<div  *ngIf="true">
													<div class="row">
														<div class="col-sm-3 vcenter">
															<gg-editor [content]="fixCost.data.name" [showControls]="true" (editSaved)="costsDescriptionUpdated(fixCost, $event)"
															  [readOnly]="fixCost.data.disabled || !authorizationStatusInfo || !authorizationStatusInfo.isAdministrator()"></gg-editor>
														</div>
														<div class="col-sm-2 vcenter">
															<gg-editor [content]="fixCost.data.price" [showControls]="true" [isMonetary]="true" (editSaved)="costsPriceUpdated(fixCost, $event)"
															  [readOnly]="fixCost.data.disabled || !authorizationStatusInfo || !authorizationStatusInfo.isAdministrator()"></gg-editor>
														</div>
														<div class="col-sm-2 vcenter" *ngIf="!fixCost.data.disabled && authorizationStatusInfo && authorizationStatusInfo.isAdministrator()">
															<img src="../../images/trash.png" (click)="deleteFixCost(fixCost)" class="imgTrash" />
														</div>
														<div class="col-sm-2 vcenter" *ngIf="fixCost.data.disabled">
															already disabled
														</div>
													</div>
												</div>
											</div>
                            			</div>
									</div>
								</div>
							</template>
						</ngb-tab>
						<ngb-tab title="{{'SUPPLIER.MENU.ADD FIX COST' | translate}}" id="tabAddFixCost" *ngIf="authorizationStatusInfo && authorizationStatusInfo.isAdministrator()">
							<template ngbTabContent>
								<div class="card">
									<div class="card-block">
										<div class="container-fluid">
											<form [formGroup]="fixCostsForm" (ngSubmit)="saveFixCosts(fixCostsForm.value, fixCostsForm.valid)">
												<div class="form-group row">
													<label for="descriptionFixCosts" class="col-sm-2 col-form-label col-xl-2">Description:</label>
													<div class="col-sm-10">
														<input type="text" min="1" class="form-control" formControlName="descriptionFixCosts" id="descriptionFixCosts" placeholder="Description of Fix Costs">
													</div>
												</div>
												<div class="form-group row">
													<label for="priceFixCosts" class="col-sm-2 col-form-label col-xl-2">Price:</label>
													<div class="col-sm-10">
														<input type="number" min="0" step="any" class="form-control" formControlName="priceFixCosts" id="priceFixCosts" placeholder="price fix costs">
													</div>
												</div>
												<div class="row">
													<div class="col-sm-3 col-md-2 col-lg-2">
														<button class="btn btn-success" type="submit" [disabled]="!fixCostsForm.valid">{{'FORM.SUBMIT' | translate}}</button>
													</div>
													<div class="col-sm-3 col-md-2 col-lg-2">
														<button class="btn btn-info" [disabled]="fixCostsForm.pristine" (click)="resetFixCosts()">{{'FORM.RESET' | translate}}</button>
													</div>
												</div>
											</form>
										</div>
									</div>
								</div>
							</template>
						</ngb-tab>
					</ngb-tabset>
				</div>
			</div>
		</template>
	</ngb-tab>

	<ngb-tab title="{{'SUPPLIER.MENU.PRODUCTS' | translate}}" id="tabProducts" *ngIf="authorizationStatusInfo && !authorizationStatusInfo.isGroupOrdersUser()">
		<template ngbTabContent>
			<gg-product-grid [path]="path+'|O:Products'" [productsObservable]="productsObservable" ></gg-product-grid>
		</template>
	</ngb-tab>
	<ngb-tab title="{{'SUPPLIER.MENU.ORDERS' | translate}}" *ngIf="anyOrder && authorizationStatusInfo && !authorizationStatusInfo.isGroupOrdersUser()" id="tabOrders" >
		<template ngbTabContent>
			<gg-order-list [ordersObservable]="ordersObservable" [config]="{skip:['supplier']}" [path]="path+'|O:Orders'" [state]="state.Orders"
				(stateChanged)="childOrdersStateChanged($event)"></gg-order-list>
		</template>
	</ngb-tab>
	<ngb-tab title="{{'SUPPLIER.MENU.SHOPPING BASKET' | translate}}" *ngIf="isThereABasket && authorizationStatusInfo && !authorizationStatusInfo.isPassiveUser()" id="tabBasket" >
		<template ngbTabContent>
			<div class="card">
				<div class="card-block">
					<div class="row">
						<gg-product-grid-basket [path]="path+'|O:Basket'" [isGroupedBasket]="authorizationStatusInfo.isGroupOrdersUser()" [productsObservable]="productsBasketObservable" [config]="{skip:['otp']}"></gg-product-grid-basket>
					</div>
					<div class="row">
						<button class="btn btn-warning" (click)="gotoPreOrder()">Proceed to Checkout</button>
					</div>
				</div>
			</div>
		</template>
	</ngb-tab>
	<ngb-tab title="{{'SUPPLIER.MENU.SHOPPING NON URGENT' | translate}}" *ngIf='isThereAGroupedBasket && authorizationStatusInfo && !authorizationStatusInfo.isGroupOrdersUser() && !authorizationStatusInfo.isPassiveUser()' id="tabGroupedBasket">
		<template ngbTabContent>
			<div class="card">
				<div class="card-block">
					<div class="row">
						<gg-product-grid-basket [path]="path+'|O:GroupedBasket'" [isGroupedBasket]="true" [productsObservable]="productsGroupedBasketObservable" [config]="{skip:['otp']}"></gg-product-grid-basket>
					</div>
				</div>
			</div>
		</template>
	</ngb-tab>
	<ngb-tab title="{{'SUPPLIER.MENU.ADD PRODUCT' | translate}}" id="tabAddProduct" *ngIf="authorizationStatusInfo && !authorizationStatusInfo.isGroupOrdersUser()">
		<template ngbTabContent>
			<div class="card">
				<div class="card-block">
					<div class="row">
						<gg-product-enter [supplierId]="supplier.data._id"></gg-product-enter>
					</div>
				</div>
			</div>
		</template>
	</ngb-tab>
	<ngb-tab title="{{'SUPPLIER.MENU.E-PROCUREMENT' | translate}}" id="tabEProc" *ngIf="supplier.data.isEproc">
		<template ngbTabContent>
			<br/>
			<div class="row" [style.color]="'green'">
				In order to shop at {{supplier.data.name}} with e-procurement, please fill this form as exacty as possible and wait for the OK before you pass the order on e-procurement.
				If you get an OK, then feel free to pass your order via e-procurement, and then finally submit this form.
			</div>
			<div class="row" [style.color]="eprocData !== false ? 'green' : 'red'"> 
				Permission to shop on e-procurement: {{eprocData !== false ? 'OK' : 'NO'}}
			</div>
			<gg-otp-checker (spendingChanged)="eprocDataChanged($event)"></gg-otp-checker>
		</template>
	</ngb-tab>
	<ngb-tab title="{{'SUPPLIER.MENU.WEB SHOPPING' | translate}}" id="tabWebShopping" *ngIf="authorizationStatusInfo && !authorizationStatusInfo.isGroupOrdersUser()">
		<template ngbTabContent>
			<div class="card">
				<div class="card-block">
					<ngb-tabset (tabChange)="beforeWebShoppingTabChange($event)" [activeId]="state.selectedWebShoppingTabId">
						<ngb-tab title="{{'SUPPLIER.MENU.ADMINISTRATION' | translate}}" id="tabWebShoppingAdmin" *ngIf="showAdminWebShoppingTab">
							<template ngbTabContent>
								<div class="card">
									<div class="card-block">
										<div class="row">
											<div class="col-sm-4 vcenter">e-procurement enabled:</div>
											<div class="col-sm-6 vcenter">
												<gg-editor-boolean [content]="supplier.data.isEproc" (editSaved)="webShoppingEprocUpdated($event)"></gg-editor-boolean>
											</div>
										</div>										
										<div class="row">
											<div class="col-sm-4 vcenter">web shopping enabled:</div>
											<div class="col-sm-6 vcenter">
												<gg-editor-boolean [content]="supplier.data.webShopping && supplier.data.webShopping.isEnabled" (editSaved)="webShoppingUpdated($event)"></gg-editor-boolean>
											</div>
										</div>
										<div class="row">
											<div class="col-sm-4 vcenter">allowed products:</div>
											<div class="col-sm-6 vcenter">
												<gg-selector [selectableData]="selectableCategoriesObservable" [selectedIds]="selectedCategoryIdsObservable" (selectionChanged)="categorySelectionChanged($event)"
													(selectionOptionAdded)="categoryHasBeenAdded($event)"></gg-selector>
											</div>
										</div>
									</div>
								</div>
							</template>
						</ngb-tab>
						<div *ngIf="supplier.data.webShopping && supplier.data.webShopping.categoryIds && supplier.data.webShopping.categoryIds.length > 0">
							<ngb-tab *ngFor="let category of supplier.annotation.webShopping.categories" title="{{'SUPPLIER.MENU.VOUCHERS' | translate}} {{category.name}}" id="tabWebShoppingVoucher{{category.id}}">
								<template ngbTabContent>
									<div class="card">
										<div class="card-block">
											<div class="row">
												<div class="col-sm-4 vcenter">vouchers available:</div>
												<div class="col-sm-6 vcenter">{{nbVouchersAvailable(category.id)}}</div>
											</div>
											<div class="row">
												<div class="col-sm-4 vcenter">vouchers ordered:</div>
												<div class="col-sm-6 vcenter">
													<gg-editor-number [content]="nbVouchersOrdered(category.id)" [editMode]="true" (editSaved)="nbVouchersOrderedUpdated(category.id, $event)"></gg-editor-number>
												</div>
											</div>
											<div class="row" *ngIf="nbVouchersAvailable(category.id) > 0">
												<p>
													<button type="button" class="btn btn-outline-primary" (click)="showUseVoucherForm = !showUseVoucherForm" [attr.aria-expanded]="!showUseVoucherForm"
														aria-controls="collapseExample">Make use of a {{category.name}} voucher</button>
												</p>
												<div id="collapseExample" [ngbCollapse]="!showUseVoucherForm">
													<div class="card">
														<div class="card-block">
															<div>Fill this form adequately and you will get the Sap Id that you need in order to place your order on the {{supplier.data.name}} webshopping platform.</div><br/>
															<form [formGroup]="useVoucherForm" (ngSubmit)="save(useVoucherForm.value, useVoucherForm.valid, supplier.data._id, category.id)">
																<div class="form-group row">
																	<label for="description" class="col-sm-2 col-form-label col-xl-2">Description:</label>
																	<div class="col-sm-10">
																		<input type="text" class="form-control" formControlName="description" id="description" placeholder="description of the product">
																	</div>
																</div>
																<div class="form-group row">
																	<label for="price" class="col-sm-2 col-form-label col-xl-2">Price:</label>
																	<div class="col-sm-10">
																		<input type="number" min="1" step="any" class="form-control" formControlName="price" id="price" placeholder="total price of web shopping (with VAT)">
																	</div>
																</div>
																<div class="form-group row">
																	<label class="col-sm-2 col-form-label col-xl-2"></label>
																	<div class="col-sm-10">
																		<input type="checkbox"  #iAgree> The information I have entered here is correct and correspond to what I have entered on the {{supplier.data.name}} website.<br>
																	</div>
																</div>
																<div class="row" >
																	<div class="col-sm-3 col-md-2 col-lg-2">
																		<button class="btn btn-success" type="submit" [disabled]="!useVoucherForm.valid || !iAgree.checked">{{'FORM.SUBMIT' | translate}}</button>
																	</div>
																	<div class="col-sm-3 col-md-2 col-lg-2">
																		<button class="btn btn-info" [disabled]="useVoucherForm.pristine" (click)="reset()">{{'FORM.RESET' | translate}}</button>
																	</div>
																</div>
																<div class="row" *ngIf="voucherUseError">
																	<p>The voucher could not be used: {{voucherUseError}}</p>
																</div>
															</form>
														</div>
													</div>
												</div>
											</div>
										</div>
									</div>
								</template>
							</ngb-tab>
						</div>
					</ngb-tabset>
				</div>
			</div>
		</template>
	</ngb-tab>
	<ngb-tab id="tabMax">
		<template ngbTabTitle><img src="../../images/maximize.png" [ngbPopover]="popContent" triggers="mouseenter:mouseleave" /></template>
		<template ngbTabContent></template>
	</ngb-tab>
	<ngb-tab id="gotoTop" *ngIf="!isRoot && path!=='dashboard'">
		<template ngbTabTitle><img src="../../images/gototop.png" ngbPopover="Goto top of the page" triggers="mouseenter:mouseleave" /></template>
		<template ngbTabContent></template>
	</ngb-tab>

</ngb-tabset>
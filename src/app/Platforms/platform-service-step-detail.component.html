<ngb-tabset *ngIf="serviceStep">
    <ngb-tab title="Info" id="tabInfo">
        <template ngbTabContent>
            <div class="card">
                <div class="card-block">
                    <div class="row">
                        <div class="col-sm-3 vcenter"><b>Name of step</b></div>
                        <div class="col-sm-8 vcenter">
                            <gg-editor [readOnly]="isSnapshot" [content]="serviceStep.data.name" [showControls]="true" (editSaved)="nameStepUpdated($event)"></gg-editor>
                        </div>
                        <div class="col-sm-3 vcenter"><b>Description</b></div>
                        <div class="col-sm-8 vcenter">
                            <gg-editor [readOnly]="isSnapshot" [content]="serviceStep.data.description" [showControls]="true" (editSaved)="descriptionStepUpdated($event)"></gg-editor>
                        </div>
                        <div class="col-sm-3 vcenter"><b>Used machine</b></div>
                        <div class="col-sm-8 vcenter">
                            <gg-editor-autocomplete [selectableData]="machineListObservable" [emptyContentText]="'choose a machine'" [selectedId]="serviceStep.data.machineId"
                                [readOnly]="isSnapshot" (idChanged)="machineChanged($event)"></gg-editor-autocomplete>
                        </div>

                        <div class="col-sm-3 vcenter"><b>Runtime (in hours)</b></div>
                        <div class="col-sm-8 vcenter">
                            <gg-editor-number [content]="serviceStep.data.runtime" (editSaved)="runtimeMachineUpdated($event, machineItem)"></gg-editor-number>
                        </div>

                    </div>
                </div>
            </div>
        </template>
    </ngb-tab>
    <ngb-tab title="Cost detail" id="tabCost">
        <template ngbTabContent>
            <div class="card">
                <div class="card-block">
                    <ngb-tabset *ngIf="serviceStep.annotation.costsByClientType">
                        <ngb-tab *ngFor="let clientType of serviceStep.annotation.costsByClientType" title="{{clientType.clientType}}">
                            <template ngbTabContent>
                                <div class="card">
                                    <div class="card-block gg-line-height">
                                        <div class="row">
                                            <div class="col-sm-3 vcenter"><b>Machine cost of run</b></div>
                                            <div class="col-sm-8 vcenter">
                                                {{serviceStep.annotation.machineCost | currency:'EUR':true:'1.2-2'}}
                                            </div>
                                        </div>

                                        <div class="row">
                                            <div class="col-sm-3 vcenter"><b>Cost of products</b></div>
                                            <div class="col-sm-8 vcenter">
                                                {{serviceStep.annotation.productsCost | currency:'EUR':true:'1.2-2'}}
                                            </div>
                                        </div>

                                        <div class="row" *ngFor="let prodExtra of clientType.productsExtras">
                                            <div class="col-sm-3 vcenter">{{prodExtra.labeltxt}}</div>
                                            <div class="col-sm-8 vcenter">
                                                {{prodExtra.extraValue | currency:'EUR':true:'1.2-2'}}
                                            </div>
                                        </div>

                                        <div class="row">
                                            <div class="col-sm-3 vcenter"><b>Cost of labour</b></div>
                                            <div class="col-sm-8 vcenter">
                                                {{serviceStep.annotation.labourCost | currency:'EUR':true:'1.2-2'}}
                                            </div>
                                        </div>

                                        <div class="row" *ngFor="let prodExtra of clientType.labourReductions">
                                            <div class="col-sm-3 vcenter">reduction on {{prodExtra.labeltxt}}</div>
                                            <div class="col-sm-8 vcenter">
                                                {{prodExtra.extraValue | currency:'EUR':true:'1.2-2'}}
                                            </div>
                                        </div>

                                        <div class="row">
                                            <div class="col-sm-3 vcenter"><b>Total cost of step</b></div>
                                            <div class="col-sm-8 vcenter gg-price">
                                                {{clientType.totalCost | currency:'EUR':true:'1.2-2'}}
                                            </div>
                                        </div>

                                        <div class="row" *ngFor="let prodExtra of clientType.totalExtras">
                                            <div class="col-sm-3 vcenter">{{prodExtra.labeltxt}}</div>
                                            <div class="col-sm-8 vcenter">
                                                {{prodExtra.extraValue | currency:'EUR':true:'1.2-2'}}
                                            </div>
                                        </div>

                                        <div class="row">
                                            <div class="col-sm-3 vcenter"><b>Price of step</b></div>
                                            <div class="col-sm-8 vcenter gg-price">
                                                {{clientType.grandTotalCost | currency:'EUR':true:'1.2-2'}}
                                            </div>
                                        </div>

                                    </div>
                                </div>

                            </template>
                        </ngb-tab>
                    </ngb-tabset>

                </div>
            </div>
        </template>
    </ngb-tab>
    <ngb-tab title="Services" id="tabServices">
        <template ngbTabContent>
            <div class="card">
                <div class="card-block">
                    <ngb-tabset>
                        <ngb-tab title="Used services" id="tabUsedServices" *ngIf="serviceStep.annotation.services && serviceStep.annotation.services.length > 0">
                            <template ngbTabContent>
                                <div class="card">
                                    <div class="card-block">
                                        <div class="row">
                                            <div class="col-sm-3 vcenter"><b>Service</b></div>
                                            <div class="col-sm-2 vcenter"><b>Nb of units used</b></div>
                                        </div>
                                        <div *ngFor="let service of (serviceStep.annotation.services || []); let pos = index">
                                            <!--FOR  -->
                                            <div class="row">
                                                <div class="col-sm-3 vcenter">
                                                    {{service.annotation.service}}
                                                </div>
                                                <div class="col-sm-2 vcenter">
                                                    <gg-editor-number [readOnly]="isSnapshot" [content]="service.data.quantity" (editSaved)="serviceQuantityUpdated(pos, $event)"></gg-editor-number>
                                                </div>
                                                <div class="col-sm-2 vcenter">
                                                    <input type="checkbox" [ngbTooltip]="'click here to select the service for deletion'" *ngIf="!service.isDueToDelete"
														 (click)="service.isDueToDelete = !service.isDueToDelete" />
														<div class="btn btn-warning btn-sm" ngbTooltip="Careful! This will delete the selected service item and can't be undone. Click here if you are sure you want to delete it."
														 *ngIf="service.isDueToDelete" (click)="deleteService(pos)">Delete</div>
														<div class="btn btn-success btn-sm" *ngIf="service.isDueToDelete" (click)="service.isDueToDelete = !service.isDueToDelete">Cancel</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </template>
                        </ngb-tab>
                        <ngb-tab title="Select services" id="tabSelectServices" *ngIf="!isSnapshot">
                            <template ngbTabContent>
                                <div class="card">
                                    <div class="card-block">
                                        <gg-platform-service-list [isForSelection]="true" [servicesObservable]="servicesObservable" [selectedServiceIds]="getServicesIdsSelected()"
                                            (servicesSelected)="servicesChanged($event)"></gg-platform-service-list>
                                    </div>
                                </div>
                            </template>
                        </ngb-tab>
                    </ngb-tabset>
                </div>
            </div>
        </template>
    </ngb-tab>
    <ngb-tab title="Products" id="tabProducts">
        <template ngbTabContent>
            <div class="card">
                <div class="card-block">
                    <ngb-tabset>
                        <ngb-tab title="Used products" id="tabUsedProducts" *ngIf="serviceStep.annotation.products && serviceStep.annotation.products.length > 0">
                            <template ngbTabContent>
                                <div class="card">
                                    <div class="card-block">
                                        <div class="row">
                                            <div class="col-sm-3 vcenter"><b>Product</b></div>
                                            <div class="col-sm-2 vcenter"><b>Nb of units used</b></div>
                                            <div class="col-sm-1 vcenter"><b>Price per unit</b></div>
                                            <div class="col-sm-2 vcenter"><b>Nb of units in product</b></div>
                                            <div class="col-sm-1 vcenter"><b>Total</b></div>
                                        </div>
                                        <div *ngFor="let product of (serviceStep.annotation.products || []); let pos = index">
                                            <!--FOR  -->
                                            <div class="row">
                                                <div class="col-sm-3 vcenter">
                                                    {{product.annotation.product}} {{product.annotation.package ? ' (' + product.annotation.package + ')' : ''}}
                                                </div>
                                                <div class="col-sm-2 vcenter">
                                                    <gg-editor-number [readOnly]="isSnapshot" [content]="product.data.quantity" (editSaved)="productQuantityUpdated(pos, $event)"></gg-editor-number>
                                                </div>
                                                <div class="col-sm-1 vcenter">
                                                    {{product.annotation.productPrice | currency:'EUR':true:'1.2-2'}}
                                                </div>
                                                <div class="col-sm-2 vcenter">
                                                    {{product.annotation.nbUnitsInProduct}}
                                                </div>
                                                <div class="col-sm-1 vcenter">
                                                    {{product.annotation.productTotal | currency:'EUR':true:'1.2-2'}}
                                                </div>
                                                <div class="col-sm-2 vcenter">
                                                    <input type="checkbox" [ngbTooltip]="'click here to select the product for deletion'" *ngIf="!product.isDueToDelete"
														 (click)="product.isDueToDelete = !product.isDueToDelete" />
														<div class="btn btn-warning btn-sm" ngbTooltip="Careful! This will delete the selected product item and can't be undone. Click here if you are sure you want to delete it."
														 *ngIf="product.isDueToDelete" (click)="deleteProduct(pos)">Delete</div>
														<div class="btn btn-success btn-sm" *ngIf="product.isDueToDelete" (click)="product.isDueToDelete = !product.isDueToDelete">Cancel</div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row gg-price">
                                            <div class="col-sm-3 vcenter"><b></b></div>
                                            <div class="col-sm-2 vcenter"><b></b></div>
                                            <div class="col-sm-1 vcenter"><b></b></div>
                                            <div class="col-sm-2 vcenter">Total:</div>
                                            <div class="col-sm-1 vcenter">{{serviceStep.annotation.productsCost | currency:'EUR':true:'1.2-2'}}</div>
                                        </div>
                                    </div>
                                </div>
                            </template>
                        </ngb-tab>
                        <ngb-tab title="Select products" id="tabSelectProducts" *ngIf="!isSnapshot">
                            <template ngbTabContent>
                                <div class="card">
                                    <div class="card-block">
                                        <gg-product-list [isForSelection]="true" [productsObservable]="productsObservable" [selectedProductIds]="getProductIdsSelected()"
                                            (productsSelected)="productsChanged($event)"></gg-product-list>
                                    </div>
                                </div>
                            </template>
                        </ngb-tab>
                    </ngb-tabset>
                </div>
            </div>
        </template>
    </ngb-tab>
    <ngb-tab title="Labour" id="tabLabour">
        <template ngbTabContent>
            <div class="card">
                <div class="card-block">
                    <ngb-tabset>
                        <ngb-tab title="Used hours" id="tabUsedLabourHours">
                            <template ngbTabContent>
                                <div class="card">
                                    <div class="card-block">
                                        <div class="row">
                                            <div class="col-sm-3 vcenter"><b>Labour</b></div>
                                            <div class="col-sm-2 vcenter"><b>Nb Hours</b></div>
                                            <div class="col-sm-2 vcenter"><b>Rate</b></div>
                                            <div class="col-sm-2 vcenter"><b>Total</b></div>
                                        </div>
                                        <div *ngFor="let labourType of (serviceStep.annotation.labourTypes || []); let pos = index">
                                            <!--FOR  -->
                                            <div class="row">
                                                <div class="col-sm-3 vcenter">
                                                    {{labourType.data.name}}
                                                </div>
                                                <div class="col-sm-2 vcenter">
                                                    <gg-editor-number [readOnly]="isSnapshot" [content]="labourType.annotation.nbHours" (editSaved)="labourQuantityUpdated(pos, $event)"></gg-editor-number>
                                                </div>
                                                <div class="col-sm-2 vcenter">
                                                    {{labourType.data.hourlyRate | currency:'EUR':true:'1.2-2'}}
                                                </div>
                                                <div class="col-sm-2 vcenter">
                                                    {{labourType.annotation.totalCost | currency:'EUR':true:'1.2-2'}}
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row gg-price">
                                            <div class="col-sm-3 vcenter"><b></b></div>
                                            <div class="col-sm-2 vcenter"><b></b></div>
                                            <div class="col-sm-2 vcenter">Total:</div>
                                            <div class="col-sm-2 vcenter">{{serviceStep.annotation.labourCost | currency:'EUR':true:'1.2-2'}}</div>
                                        </div>
                                    </div>
                                </div>

                            </template>
                        </ngb-tab>
                        <ngb-tab title="Add labour type" id="tabAddLabourType" *ngIf="false && !isSnapshot">
                            <template ngbTabContent>
                            </template>
                        </ngb-tab>
                    </ngb-tabset>
                </div>
            </div>
        </template>
    </ngb-tab>
    <ngb-tab title="Disable step" id="tabDisableStep" *ngIf="!serviceStep.data.isDisabled && !isSnapshot">
        <template ngbTabContent>
            <div class="card">
                <div class="card-block">
                    <div class="row">
                        <div class="col-sm-11">
                            <p>This action will disable the step. Are you sure you want to do that? If yes, click the button
                                below.
                            </p>
                        </div>
                        <div class="col-sm-3 col-md-2 col-lg-2" *ngIf="!serviceStep.confirmation">
                            <button class="btn btn-warning" (click)="serviceStep.confirmation = true">Disable the step</button>
                        </div>
                        <div class="col-sm-11 col-md-10 col-lg-10" *ngIf="serviceStep.confirmation">
                            <button class="btn btn-danger" (click)="enableDisableStep(true)">Now I will disable the step</button>
                            <button class="btn btn-success" (click)="serviceStep.confirmation = false">Cancel</button>
                        </div>
                    </div>
                </div>
            </div>
        </template>
    </ngb-tab>
    <ngb-tab title="Reactivate step" id="tabReactivateStep" *ngIf="serviceStep.data.isDisabled && !isSnapshot">
        <template ngbTabContent>
            <div class="card">
                <div class="card-block">
                    <div class="row">
                        <div class="col-sm-11">
                            <p>If you want to reactivate the step, click the button below.</p>
                        </div>
                        <div class="col-sm-3 col-md-2 col-lg-2">
                            <button class="btn btn-warning" (click)="enableDisableStep(false)">Now I will reactivate the step</button>
                        </div>
                    </div>
                </div>
            </div>
        </template>
    </ngb-tab>
</ngb-tabset>